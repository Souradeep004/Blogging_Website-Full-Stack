<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Post - MyBlog</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <header>
        <nav>
            <div class="logo">üìù MyBlog</div>
            <ul class="nav-links">
                <li><a href="index.html">Home</a></li>
                <li><a href="#" id="logoutLink">Logout</a></li>
            </ul>
        </nav>
    </header>

    <div class="container">
        <div class="create-post-container">
            <h1>Create New Post</h1>

            <div id="errorMessage" class="error-message" style="display: none;"></div>
            <div id="successMessage" class="success-message" style="display: none;"></div>

            <form id="createPostForm">
                <div class="form-group">
                    <label for="title">Title *</label>
                    <input type="text" id="title" required maxlength="200">
                </div>

                <div class="form-group">
                    <label for="excerpt">Excerpt *</label>
                    <textarea id="excerpt" rows="3" required maxlength="500"></textarea>
                    <small>Brief description of your post (max 500 characters)</small>
                </div>

                <div class="form-group">
                    <label for="category">Category *</label>
                    <select id="category" required>
                        <option value="">Select a category</option>
                        <option value="Technology">Technology</option>
                        <option value="Lifestyle">Lifestyle</option>
                        <option value="Travel">Travel</option>
                        <option value="Food">Food</option>
                        <option value="Business">Business</option>
                        <option value="Other">Other</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="content">Content *</label>
                    <textarea id="content" rows="15" required></textarea>
                </div>

                <div class="form-group">
                    <label for="tags">Tags</label>
                    <input type="text" id="tags" placeholder="e.g., javascript, nodejs, web">
                    <small>Comma-separated tags</small>
                </div>

                <div class="form-group">
                    <label for="readTime">Read Time</label>
                    <input type="text" id="readTime" placeholder="e.g., 5 min read">
                </div>

                <button type="submit" class="btn-primary">Publish Post</button>
            </form>
        </div>
    </div>

    <footer>
        <p>&copy; 2025 MyBlog. All rights reserved.</p>
    </footer>

    <script src="js/api.js"></script>
    <script src="js/auth.js"></script>
    <script>
        // Check if user is logged in
        if (!isAuthenticated()) {
            window.location.href = 'login.html';
        }

        const form = document.getElementById('createPostForm');
        const errorMessage = document.getElementById('errorMessage');
        const successMessage = document.getElementById('successMessage');

        form.addEventListener('submit', async (e) => {
            e.preventDefault();

            const title = document.getElementById('title').value;
            const excerpt = document.getElementById('excerpt').value;
            const content = document.getElementById('content').value;
            const category = document.getElementById('category').value;
            const tags = document.getElementById('tags').value.split(',').map(t => t.trim()).filter(t => t);
            const readTime = document.getElementById('readTime').value || '5 min read';

            const postData = {
                title,
                excerpt,
                content,
                category,
                tags,
                readTime
            };

            try {
                const response = await fetch(`${API_URL}/posts`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${getToken()}`
                    },
                    body: JSON.stringify(postData)
                });

                const data = await response.json();

                if (data.success) {
                    successMessage.textContent = 'Post created successfully! Redirecting...';
                    successMessage.style.display = 'block';
                    errorMessage.style.display = 'none';
                    
                    setTimeout(() => {
                        window.location.href = 'index.html';
                    }, 1500);
                } else {
                    errorMessage.textContent = data.message;
                    errorMessage.style.display = 'block';
                    successMessage.style.display = 'none';
                }
            } catch (error) {
                errorMessage.textContent = 'Failed to create post. Please try again.';
                errorMessage.style.display = 'block';
                successMessage.style.display = 'none';
            }
        });

        document.getElementById('logoutLink').addEventListener('click', (e) => {
            e.preventDefault();
            logout();
        });
    </script>
</body>
</html>